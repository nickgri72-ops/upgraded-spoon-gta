<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini GTA 3D</title>
<style>
body { margin:0; overflow:hidden; background:black; }

#ui {
  position:fixed;
  top:10px;
  left:10px;
  color:white;
  font-family:monospace;
  z-index:10;
}

/* TOUCH CONTROLS */
.controls {
  position:fixed;
  bottom:20px;
  left:20px;
  z-index:20;
}
.controls button {
  width:60px;
  height:60px;
  font-size:24px;
  margin:5px;
  border:none;
  border-radius:10px;
  background:rgba(255,255,255,0.7);
}

.actions {
  position:fixed;
  bottom:20px;
  right:20px;
  z-index:20;
}
.actions button {
  width:80px;
  height:60px;
  font-size:16px;
  margin:5px;
  border:none;
  border-radius:10px;
  background:rgba(255,200,200,0.8);
}
</style>
</head>

<body>
<div id="ui">WASD / Touch Controls | Enter Car | Exit Car | Shoot</div>

<!-- MOVEMENT -->
<div class="controls">
  <button id="up">â¬†</button><br>
  <button id="left">â¬…</button>
  <button id="down">â¬‡</button>
  <button id="right">âž¡</button>
</div>

<!-- ACTIONS -->
<div class="actions">
  <button id="enter">ðŸš— Enter</button><br>
  <button id="exit">ðŸš¶ Exit</button><br>
  <button id="shoot">ðŸ”« Shoot</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
/* SCENE */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

/* LIGHT */
scene.add(new THREE.AmbientLight(0xffffff,0.4));
const sun = new THREE.DirectionalLight(0xffffff,1);
sun.position.set(50,100,50);
scene.add(sun);

/* GROUND */
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(500,500),
  new THREE.MeshStandardMaterial({color:0x228B22})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

/* BUILDINGS */
for(let i=0;i<100;i++){
  let h = Math.random()*20+5;
  let b = new THREE.Mesh(
    new THREE.BoxGeometry(5,h,5),
    new THREE.MeshStandardMaterial({color:0x888888})
  );
  b.position.set((Math.random()-0.5)*200,h/2,(Math.random()-0.5)*200);
  scene.add(b);
}

/* PLAYER */
const player = new THREE.Mesh(
  new THREE.BoxGeometry(1,2,1),
  new THREE.MeshStandardMaterial({color:0xff3333})
);
player.position.y = 1;
scene.add(player);

/* CAR */
const car = new THREE.Mesh(
  new THREE.BoxGeometry(3,1.5,6),
  new THREE.MeshStandardMaterial({color:0x3333ff})
);
car.position.set(5,0.75,5);
scene.add(car);

/* INPUT STATE */
let keys = {};
let inCar = false;
let canToggleCar = true;

/* KEYBOARD */
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

/* TOUCH HELPERS */
function bind(btn,key){
  btn.ontouchstart = btn.onmousedown = ()=>keys[key]=true;
  btn.ontouchend = btn.onmouseup = ()=>keys[key]=false;
}

bind(up,"w");
bind(down,"s");
bind(left,"a");
bind(right,"d");

/* SHOOT */
let bullets = [];
function shoot(){
  let b = new THREE.Mesh(
    new THREE.SphereGeometry(0.2),
    new THREE.MeshBasicMaterial({color:0xffff00})
  );
  b.position.copy(player.position);
  b.velocity = new THREE.Vector3(0,0,-1)
    .applyQuaternion(camera.quaternion)
    .multiplyScalar(0.5);
  scene.add(b);
  bullets.push(b);
}

shootBtn = document.getElementById("shoot");
shootBtn.onclick = shoot;

/* ENTER / EXIT */
document.getElementById("enter").onclick = ()=>{
  if(!inCar && canToggleCar && player.position.distanceTo(car.position)<2){
    inCar=true;
    canToggleCar=false;
    setTimeout(()=>canToggleCar=true,300);
  }
};

document.getElementById("exit").onclick = ()=>{
  if(inCar && canToggleCar){
    inCar=false;
    canToggleCar=false;
    player.position.set(car.position.x+2,1,car.position.z);
    setTimeout(()=>canToggleCar=true,300);
  }
};

/* LOOP */
function animate(){
  requestAnimationFrame(animate);

  if(!inCar){
    if(keys.w) player.position.z -= 0.1;
    if(keys.s) player.position.z += 0.1;
    if(keys.a) player.position.x -= 0.1;
    if(keys.d) player.position.x += 0.1;
  } else {
    if(keys.w) car.position.z -= 0.2;
    if(keys.s) car.position.z += 0.2;
    if(keys.a) car.rotation.y += 0.05;
    if(keys.d) car.rotation.y -= 0.05;
    player.position.copy(car.position);
  }

  bullets.forEach(b=>b.position.add(b.velocity));

  let target = inCar ? car.position : player.position;
  camera.position.lerp(
    new THREE.Vector3(target.x,target.y+5,target.z+10),0.1
  );
  camera.lookAt(target);

  renderer.render(scene,camera);
}
animate();

/* RESIZE */
addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
